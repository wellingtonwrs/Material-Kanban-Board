var materialKanban=function(){"use strict";var e=function(e){if(null===e)return null;if(void 0!==e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}try{return apex.util.escapeHTML(String(e))}catch(a){return(e=String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}},a={start:function(e){try{apex.util.showSpinner($(e))}catch(t){var a=$("<span></span>");a.attr("id","loader"+e),a.addClass("ct-loader fa-stack fa-3x");var r=$("<i></i>");r.addClass("fa fa-circle fa-stack-2x"),r.css("color","rgba(121,121,121,0.6)");var n=$("<i></i>");n.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),n.css("animation-duration","1.8s"),a.append(r),a.append(n),$(e).append(a)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},r=function(e,a,r){null==r&&(r=!0);var n={};if("string"==typeof a)try{a=JSON.parse(a)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(a)}else n=a;try{n=$.extend(r,[],e,a)}catch(a){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(a),n=e,console.error(n)}return n},n={show:function(e,a){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),n=$("<div></div>"),t=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");n.append(t);var o=$("<span></span>").text(a).css("display","block").css("color","#707070").css("font-size","12px");r.append(n).append(o),$(e).append(r)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},t=function(e,a){var r=new Map;return e.forEach((function(e){var n=a(e);r.has(n)?r.get(n).push(e):r.set(n,[e])})),r};return{initialize:function(o,d,i,s,l,c,p,O,u){var C=r({refresh:0,staticColumns:[{COLUMN_ID:"1",COLUMN_TITLE:"To Do",COLUMN_ICON:"fa-calendar"},{COLUMN_ID:"2",COLUMN_TITLE:"In Progress",COLUMN_ICON:"fa-wrench"},{COLUMN_ID:"3",COLUMN_TITLE:"Done",COLUMN_ICON:"fa-check"}],dynamicColumns:!1,groupExtension:!1,groupColWidth:6,allowDragItemsBetweenGroups:!1,groupCollapsible:!1,printDataToConsole:!1,columnCount:!1},s,!1),g=C.staticColumns,f=null,I=null,L=null,v=null,N=0,_=100,E=$("#"+o);if(E.length>0){v=function(e){var a=$("<div></div>");return a.addClass("s-g-container"),a.css("min-height","170px"),e.append(a),a}(E),h();try{apex.jQuery("#"+c).bind("apexrefresh",(function(){0==v.children("span").length&&(I&&I.destroy(),L&&L.destroy(),h())}))}catch(e){console.log("Can't bind refresh event on "+c+". Apex is missing"),console.log(e)}C.refresh>0&&setInterval((function(){0==v.children("span").length&&(I&&I.destroy(),L&&L.destroy(),h())}),1e3*C.refresh)}else console.log("Can't find parentID: "+o);function h(){if(d)a.start(v),apex.server.plugin(d,{pageItems:l,x01:"getData"},{success:function(e){E.trigger("materialkanbandataloaded"),m(e),E.trigger("materialkanbandatarendered")},error:function(e){v.empty(),console.log(e.responseText)},dataType:"json"});else try{a.start(v),setTimeout((function(){m(dataJSON)}),500)}catch(e){console.log("need data json"),console.log(e)}}function m(a){if(C.printDataToConsole&&(console.log(JSON.stringify(a)),console.log(a)),f=a.row,v.empty(),C.dynamicColumns){var r=[];t(a.row,(function(e){return e.COLUMN_ID})).forEach((function(e,a,n){a&&r.push(e[0])})),g=r}if($.each(g,(function(a,r){!1!==p&&(r.COLUMN_ID=e(r.COLUMN_ID),r.COLUMN_TITLE=e(r.COLUMN_TITLE),r.COLUMN_ICON=e(r.COLUMN_ICON),r.COLUMN_ICON_COLOR=e(r.COLUMN_ICON_COLOR),r.COLUMN_HEADER_STYLE=e(r.COLUMN_HEADER_STYLE),r.COLUMN_COLOR=e(r.COLUMN_COLOR)),null==r.COLUMN_COLOR&&(r.COLUMN_COLOR="hsl("+46*a%350+", 55%, 60%)"),r.COLUMN_INDEX=r.COLUMN_INDEX?r.COLUMN_INDEX:a})),g&&g.length>0){N=C.groupExtension?100/(12*g.length/C.groupColWidth+1):0,_=(100-N)/g.length,N=Math.floor(100*N)/100,_=Math.floor(100*_)/100,U(v);var o=R(v);if(o.addClass("kb-group-container"),a.row&&a.row.length>0){t(a.row,(function(e){return C.groupExtension?e.GROUP_ID:1})).forEach((function(a,r,n){if(r){var t=R(o);t.addClass("kb-row"),t.attr("groupid",r),C.groupExtension&&function(a,r){!1!==p&&(r.GROUP_ID=e(r.GROUP_ID),r.GROUP_ICON=e(r.GROUP_ICON),r.GROUP_ICON_COLOR=e(r.GROUP_ICON_COLOR),r.GROUP_HEADER_STYLE=e(r.GROUP_HEADER_STYLE),r.GROUP_TITLE=e(r.GROUP_TITLE),r.GROUP_FOOTER=e(r.GROUP_FOOTER));var n=$("<div></div>");n.addClass("kb-col kb-group-region"),n.attr("style","width:"+N+"%"),a.append(n);var t=b(n,{isGroupCard:!0,ID:r.GROUP_ID,ICON:r.GROUP_ICON,ICON_COLOR:r.GROUP_ICON_COLOR,HEADER_STYLE:r.GROUP_HEADER_STYLE,TITLE:r.GROUP_TITLE,FOOTER:r.GROUP_FOOTER,LINK:r.GROUP_LINK});if(t.addClass("kb-group-card"),C.groupCollapsible){var o=$("<i></i>");o.addClass("fa fa-chevron-down");var d=$("<div></div>");d.addClass("kb-collapsable kb-collapse"),d.append(o),$(t.find(".card-header")[0]).before(d);var i=$("<i></i>");i.addClass("fa fa-chevron-up");var s=$("<div></div>");s.addClass("kb-collapsable kb-expand"),s.append(i),$(t.find(".card-header")[0]).before(s),s.attr("style","display:none")}}(t,a[0]),$.each(g,(function(r,n){!function(a,r,n){var t=$("<div></div>");t.addClass("kb-col kb-item-region"),t.attr("style","width:"+_+"%"),a.append(t);var o=$("<div></div>");o.addClass("kb-col-content");var d="border-left-color: "+n.COLUMN_COLOR+";";o.attr("style",n.COLUMN_HEADER_STYLE||d),t.append(o);var i=$("<div></div>");i.addClass("kb-col-inner-header");var s=null!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";i.append('<p class="title">'+s+"</p>"),o.append(i);var l=$("<div></div>");if(l.addClass("kb-item-container"),l.attr("columnid",n.COLUMN_ID),o.append(l),0==n.COLUMN_INDEX){var c=r.filter((function(e){return e.GROUP_NEW_ITEM_LINK}));c.length>0&&(l.addClass("kb-item-container-with-new-card"),T(o,c[0].GROUP_NEW_ITEM_LINK))}var O=r.filter((function(e){return e.COLUMN_ID==n.COLUMN_ID&&e.ID}));!function(a,r,n){a&&a.length>0&&$.each(a,(function(a,t){!1!==p&&(t.ID=e(t.ID),t.ICON=e(t.ICON),t.ICON_COLOR=e(t.ICON_COLOR),t.HEADER_STYLE=e(t.HEADER_STYLE),t.TITLE=e(t.TITLE),t.FOOTER=e(t.FOOTER)),b(r,{isGroupCard:!1,ID:t.ID,ICON:t.ICON,ICON_COLOR:t.ICON_COLOR,HEADER_STYLE:t.HEADER_STYLE,TITLE:t.TITLE,FOOTER:t.FOOTER,LINK:t.LINK},n)}))}(O,l,n)}(t,a,n)})),C.groupExtension&&C.groupCollapsible&&(t.find(".kb-collapsable").click((function(){k(t,!0)})),1===a[0].GROUP_COLLAPESED&&k(t,!1))}}));var s=a.row.filter((function(e){return e.NEW_GROUP_LINK}));C.groupExtension&&s.length>0&&function(e,a){var r=R(e);r.addClass("kb-row");e=r;var n=$("<div></div>");n.addClass("kb-group-region kb-new-group-region"),e.append(n),T(n,a)}(v,s[0].NEW_GROUP_LINK),O&&(c=0,h=null,I=dragula($(E.find(".kb-item-container")).toArray(),{direction:"vertical",accepts:function(e,a,r,n){return!!C.allowDragItemsBetweenGroups||$(r).closest(".kb-row").attr("groupid")==$(a).closest(".kb-row").attr("groupid")}}),$(".kb-item-container > .kb-card").each((function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",(function(e){e.preventDefault()}))})),I.on("drag",(function(e,a){var r=$(e),n=$(a);c=r.index();var t=r.next();h=t.length>0?$(t[0]):null;var o={itemId:r.attr("itemid"),sourceGroupId:n.closest(".kb-row").attr("groupid"),sourceColumnId:n.attr("columnid"),sourceItemIndex:c};E.trigger("materialkanbandrag",[o])})),I.on("drop",(function(e,a,r,n){var t=$(e),o=$(a),i=$(r),s={itemId:t.attr("itemid"),sourceGroupId:i.closest(".kb-row").attr("groupid"),sourceColumnId:i.attr("columnid"),sourceItemIndex:c,targetGroupId:o.closest(".kb-row").attr("groupid"),targetColumnId:o.attr("columnid"),targetItemIndex:t.index()};try{apex.server.plugin(d,{pageItems:l,x01:"moveItem",x02:s.itemId,x03:s.sourceGroupId,x04:s.sourceColumnId,x05:s.sourceItemIndex,x06:s.targetGroupId,x07:s.targetColumnId,x08:s.targetItemIndex},{success:function(e){},error:function(e){h?t.insertBefore(h):i.append(t),x(t,i.attr("columnid")),console.error(e.responseText),E.trigger("materialkanbandroperror",[s])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}x(t,o.attr("columnid")),E.trigger("materialkanbandrop",[s])})),C.groupExtension&&u&&function(){var e=0,a=null;L=dragula($(E.find(".kb-group-container")).toArray(),{direction:"vertical",moves:function(e,a,r){return $(r).closest(".kb-group-card").length>0}}),$(".kb-group-region > .kb-card").each((function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",(function(e){e.preventDefault()}))})),L.on("drag",(function(r,n){var t=$(r);e=t.index();var o=t.next();a=o.length>0?$(o[0]):null;var d={groupId:t.attr("groupid"),sourceGroupIndex:e};E.trigger("materialkanbandraggroup",[d])})),L.on("drop",(function(r,n,t,o){var i=$(r),s=($(n),$(t)),c={groupId:i.attr("groupid"),sourceGroupIndex:e,targetGroupIndex:i.index()};try{apex.server.plugin(d,{pageItems:l,x01:"moveGroup",x02:c.groupId,x03:c.sourceGroupIndex,x04:c.targetGroupIndex},{success:function(e){},error:function(e){a?i.insertBefore(a):s.append(i),console.error(e.responseText),E.trigger("materialkanbandroperror",[c])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}E.trigger("materialkanbandropgroup",[c])}))}())}else o.css("min-height",""),n.show(o,i)}else console.log("No columns defined!");var c,h}function R(e){var a=$("<div></div>");return a.addClass("s-g-row"),e.append(a),a}function U(e){var a=R(e);if(a.addClass("kb-row"),C.groupExtension){var r=$("<div></div>");r.addClass("kb-col kb-col-header"),r.attr("style","width:"+N+"%"),a.append(r)}$.each(g,(function(e,n){(r=$("<div></div>")).addClass("kb-col kb-col-header"),r.attr("style","width:"+_+"%"),r.attr("id",n.COLUMN_ID);var t=$("<div></div>");t.addClass("kb-col-header-content");var o="border-top-color: "+n.COLUMN_COLOR+";";t.attr("style",n.COLUMN_HEADER_STYLE||o);var d=void 0!==n.COLUMN_TITLE?n.COLUMN_TITLE:"";C.columnCount&&(d=d+" ("+itemsData.filter((function(e){return e.COLUMN_ID==n.COLUMN_ID&&e.ID})).length+")");t.append('<p class="title">'+d+"</p>"),r.append(t),a.append(r)}))}function b(e,a,r){var n=$("<div></div>");n.addClass("kb-card"),n.attr("itemid",a.ID);var t=$("<div></div>");if(t.addClass("card-header"),a.ICON||r&&r.COLUMN_ICON){var o=$("<i></i>");o.addClass("fa "+(a.ICON||r.COLUMN_ICON)),(a.ICON_COLOR&&a.ICON_COLOR.length>0||r&&r.COLUMN_ICON_COLOR&&r.COLUMN_ICON_COLOR.length>0)&&o.attr("style","color:"+(a.ICON_COLOR||r.COLUMN_ICON_COLOR)),t.append(o)}a.HEADER_STYLE?t.attr("style",a.HEADER_STYLE):r&&r.COLUMN_COLOR&&t.attr("style","background:"+r.COLUMN_COLOR),n.append(t);var d=$("<div></div>");d.addClass("card-content");var i=a.TITLE?a.TITLE:"";if(d.append('<p class="title">'+i+"</p>"),a.LINK){var s=$("<a></a>");s.attr("href",a.LINK),s.append(d),n.append(s)}else n.append(d);if(a.FOOTER){var l=$("<div></div>");l.addClass("card-footer");var c=$("<div></div>");c.append(a.FOOTER),l.append(c),n.append(l)}return e.append(n),n}function T(e,a){var r=$("<div></div>");r.addClass("kb-new-card");var n=$("<i></i>");n.addClass("fa fa-plus"),r.append(n);var t=$("<a></a>");t.attr("href",a),t.append(r);var o=$("<div></div>");o.addClass("kb-new-item-region"),o.append(t),e.append(o)}function x(e,a){var r=e.attr("itemid"),n=f.find((function(e){return e.ID==r})),t=g.find((function(e){return e.COLUMN_ID==a})),o=e.find(".card-header"),d=o.find("i");(n&&n.ICON||t&&t.COLUMN_ICON)&&(d.removeClass().addClass("fa "+(n.ICON||t.COLUMN_ICON)),(n.ICON_COLOR&&n.ICON_COLOR.length>0||t&&t.COLUMN_ICON_COLOR&&t.COLUMN_ICON_COLOR.length>0)&&d.attr("style","color:"+(n.ICON_COLOR||t.COLUMN_ICON_COLOR))),!n.HEADER_STYLE&&t&&t.COLUMN_COLOR&&o.attr("style","background:"+t.COLUMN_COLOR)}function k(e,a){e.find(".kb-collapsable").toggle(),e.find(".card-footer").toggle(),e.find(".kb-item-region").toggle();var r=e.find(".kb-group-region");if(r.toggleClass("kb-collapsed"),a){var n={groupId:e.attr("groupid"),collapsed:r.hasClass("kb-collapsed")};E.trigger("materialkanbangroupcollapsed",[n])}}}}}();